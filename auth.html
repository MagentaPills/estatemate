<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign in / Sign up – EstateMate</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-gray-900 flex flex-col">
  <header class="bg-white border-b border-gray-100 relative overflow-hidden">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(99,102,241,0.07),transparent_60%)] pointer-events-none"></div>
    <div class="relative z-10 max-w-7xl mx-auto flex items-center justify-between px-4 py-3 sm:px-6">
      <div class="flex items-center gap-3">
        <a href="index.html" class="text-xl font-semibold text-indigo-600 flex items-center gap-2">
          <span>EstateMate</span>
          <span class="text-[11px] font-medium text-indigo-600/80 bg-indigo-50 px-2 py-1 rounded-lg border border-indigo-200/60">AI Preview</span>
        </a>
      </div>
      <nav class="flex items-center gap-6 text-[15px] font-medium text-gray-700">
        <a href="browse.html" class="hover:text-indigo-600 transition">Browse</a>
        <a href="map.html"    class="hover:text-indigo-600 transition">Map</a>
        <a href="about.html"  class="hover:text-indigo-600 transition">About</a>
        <a href="contact.html"class="hover:text-indigo-600 transition">Contact</a>
        <a id="signInBtn"  href="auth.html" class="bg-indigo-600 text-white font-semibold px-4 py-2 rounded-full hover:bg-indigo-700 transition whitespace-nowrap hidden">Sign in</a>
        <button id="signOutBtn" type="button" class="bg-indigo-600 text-white font-semibold px-4 py-2 rounded-full hover:bg-indigo-700 transition whitespace-nowrap hidden">Sign out</button>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="bg-white py-16">
    <div class="container mx-auto px-6 text-center">
      <h2 class="text-4xl font-extrabold mb-2">Welcome</h2>
      <p class="text-gray-600">Access your saved homes and personalized recommendations.</p>
    </div>
  </section>

  <!-- Auth Card -->
  <section class="container mx-auto px-6 pb-20 flex-1">
    <div class="max-w-xl mx-auto bg-white rounded-2xl shadow-md overflow-hidden">
      <!-- Tabs -->
      <div class="grid grid-cols-2">
        <button id="tabLogin"  class="py-4 text-center font-semibold bg-indigo-600 text-white" type="button">Log In</button>
        <button id="tabSignup" class="py-4 text-center font-semibold text-gray-600 hover:text-indigo-600" type="button">Sign Up</button>
      </div>

      <!-- Body -->
      <div class="p-8 space-y-6">
        <!-- Auth alert -->
        <div id="authAlert" class="hidden rounded-lg border px-4 py-3 text-sm" role="alert" aria-live="polite"></div>

        <!-- Google -->
        <button id="googleBtn"
          class="w-full border rounded-full py-3 px-4 flex items-center justify-center gap-3 hover:bg-gray-50 transition"
          type="button" aria-label="Continue with Google">
          <svg width="20" height="20" viewBox="0 0 533.5 544.3" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path fill="#EA4335" d="M533.5 278.4c0-18.5-1.7-36.4-4.8-53.6H272v101.4h146.9c-6.3 34-25.3 62.8-53.9 82v68.1h87.1c51.1-47 80.4-116.3 80.4-198z"/>
            <path fill="#34A853" d="M272 544.3c72.9 0 134.1-24.1 178.8-65.3l-87.1-68.1c-24.2 16.2-55.2 25.8-91.7 25.8-70.4 0-130.1-47.5-151.5-111.3H31.9v69.8C76.3 486.6 168.8 544.3 272 544.3z"/>
            <path fill="#4A90E2" d="M120.5 325.4c-10.9-32.6-10.9-68 0-100.6V155H31.9C-10.7 237.3-10.7 347.4 31.9 429.7l88.6-104.3z"/>
            <path fill="#FBBC05" d="M272 106.1c39.7 0 75.5 13.7 103.7 40.6l77.7-77.7C405.9 24.4 344.7 0 272 0 168.8 0 76.3 57.7 31.9 155l88.6 69.8C141.9 153.6 201.6 106.1 272 106.1z"/>
          </svg>
          <span class="font-medium">Continue with Google</span>
        </button>

        <div class="flex items-center gap-3">
          <div class="h-px bg-gray-200 flex-1"></div>
          <span class="text-xs uppercase tracking-wider text-gray-400">or</span>
          <div class="h-px bg-gray-200 flex-1"></div>
        </div>

        <!-- LOGIN -->
        <form id="loginForm" class="space-y-5" novalidate>
          <div>
            <label for="loginEmail" class="block text-gray-700 mb-2">Email</label>
            <input id="loginEmail" type="email" autocomplete="email"
              class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300"
              placeholder="you@example.com" required />
          </div>
          <div>
            <label for="loginPassword" class="block text-gray-700 mb-2">Password</label>
            <input id="loginPassword" type="password" autocomplete="current-password"
              class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300"
              placeholder="••••••••" required />
          </div>
          <div class="flex items-center justify-between">
            <label class="inline-flex items-center gap-2 text-sm text-gray-600">
              <input type="checkbox" class="rounded border-gray-300"/>
              Remember me
            </label>
            <a href="#" class="text-sm text-indigo-600 hover:underline">Forgot password?</a>
          </div>
          <button id="loginSubmit" type="submit"
                  class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-full hover:bg-indigo-700 transition">
            Log In
          </button>
        </form>

        <!-- SIGNUP -->
        <form id="signupForm" class="space-y-5 hidden" novalidate>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label for="firstName" class="block text-gray-700 mb-2">First name</label>
              <input id="firstName" type="text" autocomplete="given-name"
                class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300" placeholder="Alex"/>
            </div>
            <div>
              <label for="lastName" class="block text-gray-700 mb-2">Last name</label>
              <input id="lastName" type="text" autocomplete="family-name"
                class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300" placeholder="Smith"/>
            </div>
          </div>

          <div>
            <label for="signupEmail" class="block text-gray-700 mb-2">Email</label>
            <input id="signupEmail" type="email" autocomplete="email"
              class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300"
              placeholder="you@example.com" required/>
          </div>

          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label for="signupPassword" class="block text-gray-700 mb-2">Password</label>
              <input id="signupPassword" type="password" autocomplete="new-password"
                class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300"
                placeholder="Minimum 8 characters" required/>
              <div class="mt-2 h-2 w-full bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full w-1/3 bg-red-300" id="pwMeter"></div>
              </div>
            </div>
            <div>
              <label for="signupConfirm" class="block text-gray-700 mb-2">Confirm password</label>
              <input id="signupConfirm" type="password" autocomplete="new-password"
                class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300"
                placeholder="Re-enter password" required/>
            </div>
          </div>

          <label class="inline-flex items-start gap-3 text-sm text-gray-600">
            <input type="checkbox" class="mt-1 rounded border-gray-300"/>
            I agree to the <a href="#" class="text-indigo-600 hover:underline">Terms</a> and
            <a href="#" class="text-indigo-600 hover:underline">Privacy Policy</a>.
          </label>

          <button id="signupSubmit" type="submit"
                  class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-full hover:bg-indigo-700 transition">
            Create Account
          </button>
        </form>

        <p class="text-center text-sm text-gray-500">
          By continuing, you acknowledge this is a visual prototype.
        </p>
      </div>
    </div>
  </section>

  <!-- Floating Chat Button (kept from your version) -->
  <button class="fixed bottom-8 right-8 bg-indigo-600 p-4 rounded-full shadow-lg hover:bg-indigo-700 transition" aria-label="Open chat">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M21 12.034A9 9 0 1111.966 3M21 12.034v9.968"/>
    </svg>
  </button>

  <!-- Tabs + password strength (unchanged UI helpers) -->
  <script>
    const tabLogin  = document.getElementById('tabLogin');
    const tabSignup = document.getElementById('tabSignup');
    const loginForm = document.getElementById('loginForm');
    const signupForm= document.getElementById('signupForm');
    const pw  = document.getElementById('signupPassword');
    const meter = document.getElementById('pwMeter');

    tabLogin.addEventListener('click', () => {
      tabLogin.classList.add('bg-indigo-600','text-white');
      tabSignup.classList.remove('bg-indigo-600','text-white');
      tabSignup.classList.add('text-gray-600');
      loginForm.classList.remove('hidden');
      signupForm.classList.add('hidden');
    });
    tabSignup.addEventListener('click', () => {
      tabSignup.classList.add('bg-indigo-600','text-white');
      tabLogin.classList.remove('bg-indigo-600','text-white');
      tabLogin.classList.add('text-gray-600');
      signupForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
    });
    pw && pw.addEventListener('input', (e) => {
      const v = e.target.value;
      let score = 0;
      if (v.length >= 8) score++;
      if (/[A-Z]/.test(v)) score++;
      if (/[0-9]/.test(v) || /[^A-Za-z0-9]/.test(v)) score++;
      meter.className = 'h-full';
      if (score === 1) meter.classList.add('w-1/3','bg-red-300');
      if (score === 2) meter.classList.add('w-2/3','bg-yellow-300');
      if (score >= 3) meter.classList.add('w-full','bg-green-400');
    });
  </script>

  <!-- Firebase auth logic (unchanged from your original file),
       PLUS navbar toggle so the Sign in / Sign out pill matches everywhere. -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      GoogleAuthProvider,
      signInWithPopup,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    const cfg = {
      apiKey: "AIzaSyCZpPsSgm9bnBeed7nRuHJOBc7MGhH0jpQ",
      authDomain: "estatemate-d54e1.firebaseapp.com",
      projectId: "estatemate-d54e1",
      storageBucket: "estatemate-d54e1.firebasestorage.app",
      messagingSenderId: "745236119215",
      appId: "1:745236119215:web:7170303f7be0010ad79e5a",
      measurementId: "G-RXWF5891QM"
    };

    // Safe init / reuse
    const app  = window._emApp || initializeApp(cfg);
    window._emApp = app;

    const auth = getAuth(app);
    const db   = getFirestore(app);
    const HOME = "index.html";

    // ----- Navbar sign-in / sign-out pill toggle (same as index.html) -----
    const signInBtn  = document.getElementById("signInBtn");
    const signOutBtn = document.getElementById("signOutBtn");

    function show(el){ el?.classList.remove("hidden"); }
    function hide(el){ el?.classList.add("hidden"); }

    onAuthStateChanged(auth, (user) => {
      // if already signed in, bounce them off this page → HOME
      if (user) {
        hide(signInBtn);
        show(signOutBtn);
        // we *also* redirect them away from auth, just like before:
        window.location.replace(HOME);
      } else {
        show(signInBtn);
        hide(signOutBtn);
      }
    });

    signOutBtn?.addEventListener("click", async () => {
      try {
        await signOut(auth);
      } catch (err) {
        console.error("Sign-out error:", err);
      }
      // after sign-out, stay on auth so they can log in again
      // OR if you prefer, redirect to HOME — your call.
      // window.location.href = "auth.html";
    });

    // ----- alert helpers for auth flows -----
    const alertBox = document.getElementById("authAlert");
    function flash(type, text) {
      if (!alertBox) return;
      alertBox.className = "rounded-lg border px-4 py-3 text-sm";
      if (type === "error") {
        alertBox.classList.add("border-red-200","bg-red-50","text-red-800");
      } else if (type === "success") {
        alertBox.classList.add("border-green-200","bg-green-50","text-green-800");
      } else {
        alertBox.classList.add("border-gray-200","bg-gray-50","text-gray-700");
      }
      alertBox.textContent = text;
      alertBox.classList.remove("hidden");
    }
    function clearFlash(){ alertBox?.classList.add("hidden"); }
    function humanizeAuthError(code) {
      switch (code) {
        case "auth/invalid-credential":
        case "auth/wrong-password":
          return "Incorrect email or password.";
        case "auth/user-not-found":
          return "No account found with that email.";
        case "auth/email-already-in-use":
          return "That email is already in use.";
        case "auth/weak-password":
          return "Please use a stronger password (at least 6–8 characters).";
        case "auth/too-many-requests":
          return "Too many attempts. Please try again later.";
        case "auth/popup-blocked":
        case "auth/popup-closed-by-user":
          return "Google sign-in was cancelled or blocked.";
        default:
          return "Something went wrong. Please try again.";
      }
    }

    // ----- Google Sign-In -----
    const googleBtn = document.getElementById("googleBtn");
    if (googleBtn) {
      const provider = new GoogleAuthProvider();
      googleBtn.addEventListener("click", async () => {
        clearFlash();
        googleBtn.disabled = true;
        try {
          const cred = await signInWithPopup(auth, provider);
          await setDoc(doc(db, "users", cred.user.uid), {
            email: cred.user.email ?? null,
            displayName: cred.user.displayName ?? null,
            photoURL: cred.user.photoURL ?? null,
            providers: cred.user.providerData.map(p => p.providerId),
            createdAt: serverTimestamp(),
            lastLoginAt: serverTimestamp()
          }, { merge: true });
          window.location.replace(HOME);
        } catch (err) {
          flash("error", humanizeAuthError(err?.code));
        } finally {
          googleBtn.disabled = false;
        }
      });
    }

    // ----- Email Login -----
    const loginFormEl = document.getElementById("loginForm");
    const loginSubmit = document.getElementById("loginSubmit");
    loginFormEl?.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearFlash();
      loginSubmit && (loginSubmit.disabled = true);
      try {
        const email = document.getElementById("loginEmail").value.trim();
        const pass  = document.getElementById("loginPassword").value;
        const cred  = await signInWithEmailAndPassword(auth, email, pass);

        await setDoc(doc(db, "users", cred.user.uid), {
          lastLoginAt: serverTimestamp()
        }, { merge: true });

        window.location.replace(HOME);
      } catch (err) {
        flash("error", humanizeAuthError(err?.code));
      } finally {
        loginSubmit && (loginSubmit.disabled = false);
      }
    });

    // ----- Email Sign-Up -----
    const signupFormEl = document.getElementById("signupForm");
    const signupSubmit = document.getElementById("signupSubmit");
    signupFormEl?.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearFlash();
      signupSubmit && (signupSubmit.disabled = true);

      try {
        const email = document.getElementById("signupEmail").value.trim();
        const pass  = document.getElementById("signupPassword").value;
        const confirm = document.getElementById("signupConfirm").value;
        if (pass !== confirm) throw { code: "auth/password-mismatch" };

        const first = document.getElementById("firstName")?.value || null;
        const last  = document.getElementById("lastName")?.value || null;

        const cred = await createUserWithEmailAndPassword(auth, email, pass);

        await setDoc(doc(db, "users", cred.user.uid), {
          email,
          firstName: first,
          lastName: last,
          providers: ["password"],
          createdAt: serverTimestamp(),
          lastLoginAt: serverTimestamp()
        }, { merge: true });

        window.location.replace(HOME);
      } catch (err) {
        if (err.code === "auth/password-mismatch") {
          flash("error", "Passwords do not match.");
        } else {
          flash("error", humanizeAuthError(err?.code));
        }
      } finally {
        signupSubmit && (signupSubmit.disabled = false);
      }
    });

  </script>
</body>
</html>
